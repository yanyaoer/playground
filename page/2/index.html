<!doctype html><html><head><meta name=generator content="Hugo 0.68.3"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>yányào.com</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate type=application/rss+xml href=http://y%C3%A1ny%C3%A0o.com/index.xml title=yányào.com><meta property="og:title" content="yányào.com"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="http://y%C3%A1ny%C3%A0o.com/"><meta property="og:updated_time" content="2020-07-02T22:55:53+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="yányào.com"><meta name=twitter:description content><link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=http://y%C3%A1ny%C3%A0o.com/css/normalize.css><link rel=stylesheet type=text/css media=screen href=http://y%C3%A1ny%C3%A0o.com/css/main.css><script src=http://y%C3%A1ny%C3%A0o.com/js/main.js></script></head><body><div class="container wrapper"><div class=header><h1 class=site-title><a href=http://y%C3%A1ny%C3%A0o.com/>yányào.com</a></h1><div class=site-description><nav class="nav social"><ul class=flat></ul></nav></div><nav class=nav><ul class=flat></ul></nav></div><div class="recent-posts section"><h2 class=section-header>Recent posts</h2><div class=posts><div class=post><div class=meta>Oct 25, 2016</div><a class=title href=/posts/leonard-cohen-you-want-it-darker/>Leonard Cohen - you want it darker</a> &mdash;
<span class=description>年度最佳
you want it darker
循环听了好几天
干净低沉的嗓音加配乐
愈发担心以后听不到了怎么办 😢～&mldr;</span></div><div class=post><div class=meta>Jun 15, 2016</div><a class=title href=/posts/web-audio/>web audio</a> &mdash;
<span class=description>照文档撸了一下 AudioContext 可视化音频
桌面浏览器上 Safari 9, Chrome stable 绘制正常
移动端只有微信的 webview 能工作, 纯玩票叻 ref: https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API/Visualizations_with_Web_Audio_API
&lt;!DOCTYPE html> &lt;html> &lt;head> &lt;meta charset="utf-8"> &lt;meta name="viewport" content="width=device-width, user-scalable=no"> &lt;title>AV&lt;/title> &lt;/head> &lt;body> &lt;canvas id="vis">&lt;/canvas> &lt;audio id="av" src="YOUR_AUDIO_FILE">&lt;/audio> &lt;script src="index.js">&lt;/script> &lt;/body> &lt;/html> window.AudioContext = window.AudioContext || window.webkitAudioContext || window.mozAudioContext; window.onload = function(){ var canvas = document.getElementById('vis'); var canvasCtx = canvas.getContext('2d'); var isPlaying = true; var audio = document.getElementById('av'); var audioCtx = new AudioContext(); var analyser = audioCtx.&mldr;</span></div><div class=post><div class=meta>Apr 26, 2016</div><a class=title href=/posts/move-to-caddy/>move to caddy</a> &mdash;
<span class=description>去年用 Hexo 搭建的日志已经好几个月没更新了，最近休假有点空闲就继续更新吧。
先从 Github 迁移回自己的 Linode，然后安装一个 Caddyserver1 来渲染 markdown
Caddy is a unique web server with a modern feature set. Think nginx or Apache, but written in Go. With Caddy, you can serve your websites over HTTP/2. It can act as a reverse proxy and load balancer. Front your PHP apps with it. You can even deploy your site with git push. Cool, right?2
Download and install systemd wget -O 'caddy.&mldr;</span></div><div class=post><div class=meta>Dec 22, 2015</div><a class=title href=/posts/mongodb-backup/>mongodb backup</a> &mdash;
<span class=description>有台机器准备2月份下架 记一个 mongodb 备份小脚本 :)
#!/bin/bash # vim: set et sw=2 ts=2 sts=2 ff=unix fenc=utf8: MONGO_DATABASE="_name_" MONGO_HOST="_ip_" MONGO_PORT="_prot_" TIMESTAMP=`date +%Y-%m-%dT%H:%M:%S` MONGODUMP_PATH="/usr/bin/mongodump" BACKUPS_DIR="/data/dumps/" BACKUP_NAME="$MONGO_DATABASE-$TIMESTAMP" while test $# -gt 0 do case "$1" in -m) echo "backup mongthly and clear week_dir" #rm $BACKUPS_DIR"week/*" find $BACKUPS_DIR"week" -type f -name '*.tgz' -delete tar -czPf $BACKUPS_DIR"month/"$BACKUP_NAME.tgz $BACKUPS_DIR$MONGO_DATABASE ;; -w) echo "backup weekly" echo "tar -czPf $BACKUPS_DIR"week/"$BACKUP_NAME.tgz $BACKUPS_DIR$MONGO_DATABASE" ;; -d) echo "just dump" $MONGODUMP_PATH -d $MONGO_DATABASE --out $BACKUPS_DIR ;; *) echo "do nothing" ;; esac shift done # crontab -e 10 3 * * * /bin/bash $HOME/bin/mongobackup.&mldr;</span></div><div class=post><div class=meta>Dec 14, 2015</div><a class=title href=/posts/let-s-encrypt/>let's encrypt</a> &mdash;
<span class=description>Let&rsquo;s Encrypt 已经公开测试，不需要再提交测试域名表单，直接就能申请
小项目以后都能用这玩意开 https 不用花钱买证书哦啦啦
照 文档 做一遍给域名签上证书还挺简单的
# 获取项目代码 git clone https://github.com/letsencrypt/letsencrypt cd letsencrypt # 安装依赖 ./letsencrypt-auto # 获取证书 ./letsencrypt-auto certonly --standalone -d www.example.com -d example.com # 配置 nginx server { listen 443 ; ssl on; ssl_certificate_key /etc/letsencrypt/live/youdomain/privkey.pem; ssl_certificate /etc/letsencrypt/live/youdomain/fullchain.pem; } 需要注意的是 dnspod 等国内服务解析域名有问题
我这里直接切回 domains.google.com 就行了
使用 standalone 模式需要先停掉默认的 nginx
文档里提到可以使用 webroot 模式不用停 但我创建验证文件失败了 :(
默认90天过期，建议 crontab 定时更新
###Update
使用 acme.sh
An ACME protocol client written purely in Shell (Unix shell) language.&mldr;</span></div><div class=post><div class=meta>Oct 17, 2015</div><a class=title href=/posts/simple-nodejs-crawler/>simple crawler</a> &mdash;
<span class=description>半夜看了本小说觉得翻页太累
首先要解决的问题是找一个质量还过得去的小说站 然后写个脚本去把它爬下来章节合并到一起
import fs from "fs"; import { argv } from "process"; import request from "request"; import cheerio from "cheerio"; import iconv from "iconv-lite"; import sanitize from 'sanitize-html'; class main { constructor() { Object.assign(this, { path: './chapter.json', html: './reader.html', url: { list: 'http://www.piaotian.net/html/6/6658/' }, store: [] }) } fetch(url, callback) { request.get(url, {encoding: null}, (error, response, body)=> { if (!error && response.statusCode == 200) { let $ = cheerio.load(iconv.decode(body, 'GBK')); callback($, body); } else { console.&mldr;</span></div><div class=post><div class=meta>Oct 11, 2015</div><a class=title href=/posts/send-notification-after-task-end/>send notification when task finish</a> &mdash;
<span class=description>终端里运行长时间任务(比如 make systemimage)的时候经常会切换到其他环境做别的事情 容易忘记查看之前的任务是否完成, 查到一些方法用在任务结束时发出通知
#C-z 切到后台运行 fg; tput bel # Mac OS X #系统弹窗 osascript -e 'tell app "System Events" to display alert "Build Completed" message "The checkout and build have completed."' say "Job finished" #语音播报 #notification center osascript -e 'display notification "Job finished" with title "Alert"' sudo gem install terminal-notifier terminal-notifier -message "Job finished!" -title "Alert" # Ubuntu notify-send "Job finished!" # KDE kdialog --passivepopup 'Job finished' 还有 iterm2 trigger 也能用来触发通知, 高亮文字&mldr;</span></div><div class=post><div class=meta>Oct 4, 2015</div><a class=title href=/posts/cname-with-yanyao-com/>create CNAME with internationalized domain name</a> &mdash;
<span class=description>前段时间买了个 idn: yányào.com 闲置了很长时间没动 趁着十一长假无所事事的机会, 把玩了一下 hexo 挂到 yanyaoer.github.io
然后 CNAME 的时候掉坑了, 看到有人说30分钟生效傻傻等就不提了 实际上这个域名的 CNAME 内容应该用编码后的字符串而不是 yányào.com
https://github.com/yanyaoer/yanyaoer.github.io/commit/7c0e4e6863904442d368e3ad5c822f8f189bb7fc#diff-adc4bfdb0829dae99e3699393e3fbaa4
diff --git a/CNAME b/CNAME index 6cb647c..92d166c 100644 --- a/CNAME +++ b/CNAME @@ -1 +1 @@ -yányào.com +xn--ynyo-2nad.com &mldr;</span></div><div class=post><div class=meta>Oct 4, 2015</div><a class=title href=/posts/xtag-and-shadowdom/>xtag-and-shadowdom</a> &mdash;
<span class=description>最近在做的项目重构, 原本打算用 reactjs, 写了一些实验代码后心累无爱 找了个 domdiff 配合自定义标签和 shadowdom 的独有作用域也是爽 YY
可惜的是测试红米上的 android webview 版本(32?)不支持 ::shadow 伪类 inline 方式覆盖样式略嫌繁琐
示例代码 xtag.js let dom = { shadow(el) { return el.createShadowRoot ? el.createShadowRoot() : el.webkitCreateShadowRoot(); }, attr(el, prefix='') { return Object.keys(el.dataset).map((d)=> `${prefix}${d}="${el.dataset[d]}"`).join(' ') } } document.registerElement('x-image', { prototype: Object.create(HTMLElement.prototype, { createdCallback: { value() { //xtag 嵌套时这里读不到attr, 放到 attach console.log('onCreate::image'); } }, attachedCallback: { value() { console.log('onAttach::image'); let shadow = dom.shadow(this); shadow.innerHTML = `&lt;style> img { max-width: 100%; } &lt;/style> &lt;img ${dom.&mldr;</span></div><div class=post><div class=meta>Jan 20, 2015</div><a class=title href=/posts/remote-pbcopy-with-netcat/>remote pbcopy with netcat</a> &mdash;
<span class=description>Quick start while (true); do nc -l 2224 | pbcopy; done #If your laptop is running linux, replacing pbcopy with xcopy should work: #while (true); do nc -l 2224 | xcopy; done echo "This text gets sent to clipboard" | nc localhost 2224 echo "RemoteForward 2224 localhost:2224" >> ~/.ssh/config ssh remote -t 'cat blablabla | nc -q0 localhost 2224' Daemonizing pbcopy launchctl load ~/Library/LaunchAgents/local.pbcopy.plist
&lt;?xml version="1.0" encoding="UTF-8"?> &lt;!DOCTYPE plist PUBLIC "-//Apple Computer//DTD PLIST 1.&mldr;</span></div><ul class=pagination><li class="page-item page-prev"><a href=/ class=page-link aria-label=Previous><span aria-hidden=true>← Prev page</span></a></li><li class="page-item page-next"><a href=/page/3/ class=page-link aria-label=Next><span aria-hidden=true>Next page →</span></a></li></ul></div></div></div><div class="footer wrapper"><nav class=nav><div><a href=https://github.com/vividvilla/ezhil>Ezhil theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></nav></div></body></html>