<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Cronjob on yányào.com</title><link>https://xn--ynyo-2nad.com/tags/cronjob/</link><description>Recent content in Cronjob on yányào.com</description><generator>Hugo</generator><language>en-us</language><lastBuildDate>Tue, 22 Dec 2015 13:30:24 +0000</lastBuildDate><atom:link href="https://xn--ynyo-2nad.com/tags/cronjob/index.xml" rel="self" type="application/rss+xml"/><item><title>mongodb backup</title><link>https://xn--ynyo-2nad.com/posts/mongodb-backup/</link><pubDate>Tue, 22 Dec 2015 13:30:24 +0000</pubDate><guid>https://xn--ynyo-2nad.com/posts/mongodb-backup/</guid><description>有台机器准备2月份下架 记一个 mongodb 备份小脚本 :)
#!/bin/bash # vim: set et sw=2 ts=2 sts=2 ff=unix fenc=utf8: MONGO_DATABASE=&amp;#34;_name_&amp;#34; MONGO_HOST=&amp;#34;_ip_&amp;#34; MONGO_PORT=&amp;#34;_prot_&amp;#34; TIMESTAMP=`date +%Y-%m-%dT%H:%M:%S` MONGODUMP_PATH=&amp;#34;/usr/bin/mongodump&amp;#34; BACKUPS_DIR=&amp;#34;/data/dumps/&amp;#34; BACKUP_NAME=&amp;#34;$MONGO_DATABASE-$TIMESTAMP&amp;#34; while test $# -gt 0 do case &amp;#34;$1&amp;#34; in -m) echo &amp;#34;backup mongthly and clear week_dir&amp;#34; #rm $BACKUPS_DIR&amp;#34;week/*&amp;#34; find $BACKUPS_DIR&amp;#34;week&amp;#34; -type f -name &amp;#39;*.tgz&amp;#39; -delete tar -czPf $BACKUPS_DIR&amp;#34;month/&amp;#34;$BACKUP_NAME.tgz $BACKUPS_DIR$MONGO_DATABASE ;; -w) echo &amp;#34;backup weekly&amp;#34; echo &amp;#34;tar -czPf $BACKUPS_DIR&amp;#34;week/&amp;#34;$BACKUP_NAME.tgz $BACKUPS_DIR$MONGO_DATABASE&amp;#34; ;; -d) echo &amp;#34;just dump&amp;#34; $MONGODUMP_PATH -d $MONGO_DATABASE --out $BACKUPS_DIR ;; *) echo &amp;#34;do nothing&amp;#34; ;; esac shift done # crontab -e 10 3 * * * /bin/bash $HOME/bin/mongobackup.</description></item></channel></rss>